import{r as t,q as ie,j as e,a as ce}from"./app-eXGWw0Q1.js";import{C as de}from"./ContentTemplate-Tjr8Dmcy.js";import{T as me}from"./TitleTemplate-g8fmxVri.js";import{A as ue,I as i,m as D,b as N,K as T,a as he}from"./AuthenticatedLayout-xmXHQCqJ.js";import{T as pe}from"./toast.esm-hh8KxqiJ.js";import{C as K}from"./calendar.esm-zfuum9_B.js";import{S as xe}from"./Select-okRpXzt-.js";import{F as fe}from"./FilterTemplate-NM1ULPE2.js";import{i as I}from"./chunk-TC4QW7OA-vNTTWJaW.js";import{d as A,a as z,b as M,m as R}from"./chunk-L6QJ42W6-38BLIl0j.js";import{t as be,p as je,a as we,b as ge,c as Ce,d as Ne,e as r}from"./chunk-YRZGWF2W-C22kSm3v.js";import"./import-l4FZ2bLw.js";import"./import-oEubEFRA.js";import"./import-cu65eCSh.js";import"./import-Yb5YGcqg.js";import"./chunk-AMSULWPV-Pe1sDtjI.js";const Ee=({auth:V})=>{const H=t.useRef(null),{historial:_,tipos:S,autores:v,acciones:J}=ie().props,[q,G]=t.useState([]),[d,O]=t.useState(""),[m,k]=t.useState(""),[x,f]=t.useState(""),[b,j]=t.useState(""),[w,g]=t.useState(""),Q=!!x,U=!!b,W=!!w,[u,B]=t.useState("all"),[L,X]=t.useState("all"),[h,P]=t.useState("all"),[C,_e]=t.useState({column:"fecha",direction:"ascending"}),Y=[{name:"ID",uid:"id",sortable:!0},{name:"#",uid:"numero",sortable:!0},{name:"Fecha",uid:"fecha",sortable:!0},{name:"Autor",uid:"autor",sortable:!0},{name:"Tipo",uid:"tipo",sortable:!0},{name:"ID anexo",uid:"id_anexo",sortable:!0},{name:"# anexo",uid:"numero_anexo",sortable:!0},{name:"Fecha anexo",uid:"fecha_anexo",sortable:!0},{name:"Responsable",uid:"responsable",sortable:!0},{name:"AcciÃ³n",uid:"accion",sortable:!0},{name:"Detalles",uid:"detalles",sortable:!0},{name:"Creado",uid:"creado",sortable:!0}],y=t.useMemo(()=>{let s=[..._];if(Q&&(s=s.filter(a=>a.doc_numero==parseInt(x))),U&&(s=s.filter(a=>(a.responsable.nombres+" "+a.responsable.apellidos).toLowerCase().includes(b.toLowerCase()))),W&&(s=s.filter(a=>a.detalles?a.detalles.toLowerCase().includes(w.toLowerCase()):null)),d&&(s=s.filter(a=>{const l=new Date(a.doc_fecha);return l>=d[0]&&l<=d[1]})),m&&(s=s.filter(a=>{const l=new Date(a.created_at);return l>=m[0]&&l<=m[1]})),u!=="all"&&Array.from(u).length!==S.length){let a=new Set([...u].map(l=>{const o=S.find(c=>c.id===parseInt(l));return o?o.nombre:null}).filter(l=>l!==null));s=s.filter(l=>Array.from(a).includes(l.doc_tipo))}if(h!=="all"&&Array.from(h).length!==v.length){let a=new Set([...h].map(l=>{const o=v.find(c=>c.id===parseInt(l));return o?[o.nombres+" "+o.apellidos]:null}).filter(l=>l!==null));s=s.filter(l=>Array.from(a).some(o=>JSON.stringify(o)===JSON.stringify([l.doc_autor])))}return s},[_,x,w,b,u,L,h,d,m]),[F,n]=t.useState(1),[p,Z]=t.useState(8),$=Math.ceil(y.length/p),E=t.useMemo(()=>{const s=(F-1)*p,a=s+p;return y.slice(s,a)},[F,y,p]),ee=t.useMemo(()=>[...E].sort((s,a)=>{const l=s[C.column],o=a[C.column],c=l<o?-1:l>o?1:0;return C.direction==="descending"?-c:c}),[C,E]),se=t.useCallback(s=>{s?(f(s),n(1)):f("")},[]),te=t.useCallback(()=>{f(""),n(1)},[]),ae=t.useCallback(s=>{s?(j(s),n(1)):j("")},[]),le=t.useCallback(()=>{j(""),n(1)},[]),re=t.useCallback(s=>{s?(g(s),n(1)):g("")},[]),oe=t.useCallback(()=>{g(""),n(1)},[]),ne=()=>{f(""),k(""),O(""),B("all"),P("all"),j(""),g("")};return e.jsxs(ue,{user:V.user,children:[e.jsx(ce,{title:"Historial de documentos anexos"}),e.jsx(pe,{ref:H}),e.jsx(me,{children:"Historial documentos anexos"}),e.jsx(fe,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"xl:flex justify-center gap-4 items-end",children:[e.jsxs("div",{className:"md:flex md:gap-2",children:[e.jsx(I,{isClearable:!0,classNames:{input:["border-none"]},type:"text",className:"w-full mb-1",size:"sm",placeholder:"Buscar por numero...",startContent:e.jsx(i,{path:D,size:1}),value:x,onClear:()=>te(),onValueChange:se}),e.jsx(I,{isClearable:!0,classNames:{input:["border-none"]},type:"text",className:"w-full mb-1",size:"sm",placeholder:"Buscar por responsable...",startContent:e.jsx(i,{path:D,size:1}),value:b,onClear:()=>le(),onValueChange:ae}),e.jsx(I,{isClearable:!0,classNames:{input:["border-none"]},type:"text",className:"w-full mb-1",size:"sm",placeholder:"Buscar por detalles...",startContent:e.jsx(i,{path:D,size:1}),value:w,onClear:()=>oe(),onValueChange:re})]}),e.jsxs("div",{className:"md:flex items-center md:gap-2",children:[e.jsx("div",{className:"w-full card mb-1",children:e.jsx(K,{className:"max-h-10 border-0 flex p-0",placeholder:"Fecha documento",dateFormat:"yy//mm/dd",showIcon:!0,value:d,onChange:s=>O(s.value),selectionMode:"range",readOnlyInput:!0})}),e.jsx("div",{className:"w-full card mb-1",children:e.jsx(K,{className:"max-h-10 border-0 flex p-0",placeholder:"Fecha registro",dateFormat:"yy//mm/dd",showIcon:!0,value:m,onChange:s=>k(s.value),selectionMode:"range",readOnlyInput:!0})}),e.jsxs("div",{className:"flex gap-2 mb-1",children:[e.jsx("div",{children:e.jsxs(A,{children:[e.jsx(z,{className:"text-tiny lg:text-small",children:e.jsx(N,{endContent:e.jsx(i,{path:T,size:1}),variant:"flat",children:"Accion"})}),e.jsx(M,{disallowEmptySelection:!0,"aria-label":"Table Columns",closeOnSelect:!1,selectedKeys:L,selectionMode:"multiple",onSelectionChange:X,children:J.map(s=>e.jsx(R,{children:s.nombre},s.id))})]})}),e.jsx("div",{children:e.jsxs(A,{children:[e.jsx(z,{className:"text-tiny lg:text-small",children:e.jsx(N,{endContent:e.jsx(i,{path:T,size:1}),variant:"flat",children:"Tipo"})}),e.jsx(M,{disallowEmptySelection:!0,"aria-label":"Table Columns",closeOnSelect:!1,selectedKeys:u,selectionMode:"multiple",onSelectionChange:B,children:S.map(s=>e.jsx(R,{children:s.nombre},s.id))})]})}),e.jsx("div",{children:e.jsxs(A,{children:[e.jsx(z,{className:"text-tiny lg:text-small",children:e.jsx(N,{endContent:e.jsx(i,{path:T,size:1}),variant:"flat",children:"Autor"})}),e.jsx(M,{disallowEmptySelection:!0,"aria-label":"Table Columns",id:"autor",selectedKeys:h,onSelectionChange:P,closeOnSelect:!1,selectionMode:"multiple",items:v,children:s=>e.jsx(R,{children:s.nombres},s.id)})]})})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("span",{className:"text-default-400 text-tiny lg:text-small",children:["Total ",_.length," filas"]})}),e.jsxs("div",{className:"flex gap-5",children:[e.jsxs(N,{color:"warning",className:"min-w-0 min-h-0",onPress:()=>ne(),children:[e.jsx(i,{path:he,size:1}),e.jsx("p",{className:"hidden sm:flex",children:"Limpiar filtros"})]}),e.jsxs("label",{className:"flex items-center text-default-400 text-tiny lg:text-small",children:["Filas por pagina:",e.jsx(xe,{onChange:s=>{Z(s),n(1)},value:p,opciones:[{id:5,nombre:5},{id:8,nombre:8},{id:12,nombre:12}]})]})]})]})]})}),e.jsx(de,{children:e.jsx("div",{children:e.jsx("div",{children:e.jsxs(be,{"aria-label":"Tabla historial",color:"primary",selectedKeys:q,onSelectionChange:G,bottomContent:e.jsx("div",{className:"flex w-full justify-center",children:e.jsx(je,{isCompact:!0,showControls:!0,showShadow:!0,color:"secondary",page:F,total:$,onChange:s=>n(s)})}),classNames:{wrapper:"min-h-[222px]"},children:[e.jsx(we,{children:Y.map(s=>e.jsx(ge,{className:"text-start text-small",children:s.name},s.uid))}),e.jsx(Ce,{emptyContent:"No existen historial",children:ee.map((s,a)=>e.jsxs(Ne,{className:"text-start",children:[e.jsx(r,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.doc_id}),e.jsx(r,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.doc_numero}),e.jsx(r,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.doc_fecha}),e.jsx(r,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.doc_autor}),e.jsx(r,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.doc_tipo}),e.jsx(r,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.doc_anexo_id}),e.jsx(r,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.doc_anexo_numero}),e.jsx(r,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.doc_anexo_fecha}),e.jsxs(r,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:[s.responsable.nombres," ",s.responsable.apellidos]}),e.jsx(r,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.accion.nombre}),e.jsx(r,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.detalles}),e.jsx(r,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:new Date(s.created_at).toLocaleString()})]},a))})]})})})})]})};export{Ee as default};
