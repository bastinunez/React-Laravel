import{r as t,q as te,j as e,a as ae}from"./app-eXGWw0Q1.js";import{C as le}from"./ContentTemplate-Tjr8Dmcy.js";import{T as re}from"./TitleTemplate-g8fmxVri.js";import{A as oe,I as u,m as v,b as T,K as ne,a as ie}from"./AuthenticatedLayout-xmXHQCqJ.js";import{T as ce}from"./toast.esm-hh8KxqiJ.js";import{C as z}from"./calendar.esm-zfuum9_B.js";import{S as de}from"./Select-okRpXzt-.js";import{F as me}from"./FilterTemplate-NM1ULPE2.js";import{i as F}from"./chunk-TC4QW7OA-vNTTWJaW.js";import{d as ue,a as pe,b as he,m as fe}from"./chunk-L6QJ42W6-38BLIl0j.js";import{t as xe,p as be,a as je,b as ge,c as Ce,d as we,e as p}from"./chunk-YRZGWF2W-C22kSm3v.js";import"./import-l4FZ2bLw.js";import"./import-oEubEFRA.js";import"./import-cu65eCSh.js";import"./import-Yb5YGcqg.js";import"./chunk-AMSULWPV-Pe1sDtjI.js";const Ve=({auth:M})=>{const k=t.useRef(null),{historial:N,tipos:Ne,autores:D,acciones:S}=te().props,[B,L]=t.useState([]),[i,I]=t.useState(""),[c,A]=t.useState(""),[h,f]=t.useState(""),[x,b]=t.useState(""),[j,g]=t.useState(""),O=!!h,P=!!x,V=!!j,[E,H]=t.useState("all"),[d,K]=t.useState("all"),[C,J]=t.useState("all");t.useState("all");const[w,Se]=t.useState({column:"fecha",direction:"ascending"}),q=[{name:"Nombre",uid:"nombre",sortable:!0},{name:"Responsable",uid:"responsable",sortable:!0},{name:"AcciÃ³n",uid:"accion",sortable:!0},{name:"Detalles",uid:"detalles",sortable:!0},{name:"Creado",uid:"creado",sortable:!0}],y=t.useMemo(()=>{let s=[...N];if(O&&(s=s.filter(a=>a.doc_numero==parseInt(h))),P&&(s=s.filter(a=>(a.responsable.nombres+" "+a.responsable.apellidos).toLowerCase().includes(x.toLowerCase()))),V&&(s=s.filter(a=>a.detalles?a.detalles.toLowerCase().includes(j.toLowerCase()):null)),i&&(s=s.filter(a=>{const l=new Date(a.doc_fecha);return l>=i[0]&&l<=i[1]})),c&&(s=s.filter(a=>{const l=new Date(a.created_at);return l>=c[0]&&l<=c[1]})),d!=="all"&&Array.from(d).length!==S.length){let a=new Set([...d].map(l=>{const r=S.find(n=>n.id===parseInt(l));return r?r.nombre:null}).filter(l=>l!==null));s=s.filter(l=>Array.from(a).includes(l.accion.nombre))}if(C!=="all"&&Array.from(C).length!==D.length){let a=new Set([...C].map(l=>{const r=D.find(n=>n.id===parseInt(l));return r?[r.nombres+" "+r.apellidos]:null}).filter(l=>l!==null));s=s.filter(l=>Array.from(a).some(r=>JSON.stringify(r)===JSON.stringify([l.doc_autor])))}return s},[N,h,j,x,E,d,C,i,c]),[_,o]=t.useState(1),[m,U]=t.useState(8),G=Math.ceil(y.length/m),R=t.useMemo(()=>{const s=(_-1)*m,a=s+m;return y.slice(s,a)},[_,y,m]),Q=t.useMemo(()=>[...R].sort((s,a)=>{const l=s[w.column],r=a[w.column],n=l<r?-1:l>r?1:0;return w.direction==="descending"?-n:n}),[w,R]),W=t.useCallback(s=>{s?(f(s),o(1)):f("")},[]),X=t.useCallback(()=>{f(""),o(1)},[]),Y=t.useCallback(s=>{s?(b(s),o(1)):b("")},[]),Z=t.useCallback(()=>{b(""),o(1)},[]),$=t.useCallback(s=>{s?(g(s),o(1)):g("")},[]),ee=t.useCallback(()=>{g(""),o(1)},[]),se=()=>{f(""),A(""),I(""),H("all"),J("all"),b(""),g("")};return e.jsxs(oe,{user:M.user,children:[e.jsx(ae,{title:"Historial acciones sobre usuario"}),e.jsx(ce,{ref:k}),e.jsx(re,{children:"Historial acciones usuario"}),e.jsx(me,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"xl:flex md:gap-2",children:[e.jsxs("div",{className:"md:flex gap-4 justify-center items-end",children:[e.jsx(F,{isClearable:!0,classNames:{input:["border-none"]},type:"text",className:"w-full mb-1",size:"sm",placeholder:"Buscar por numero...",startContent:e.jsx(u,{path:v,size:1}),value:h,onClear:()=>X(),onValueChange:W}),e.jsx(F,{isClearable:!0,classNames:{input:["border-none"]},type:"text",className:"w-full mb-1",size:"sm",placeholder:"Buscar por responsable...",startContent:e.jsx(u,{path:v,size:1}),value:x,onClear:()=>Z(),onValueChange:Y}),e.jsx(F,{isClearable:!0,classNames:{input:["border-none"]},type:"text",className:"w-full mb-1",size:"sm",placeholder:"Buscar por detalles...",startContent:e.jsx(u,{path:v,size:1}),value:j,onClear:()=>ee(),onValueChange:$})]}),e.jsxs("div",{className:"md:flex gap-4 justify-center items-end",children:[e.jsx("div",{className:"w-full card mb-1",children:e.jsx(z,{className:"max-h-10 border-0 flex p-0",placeholder:"Rango de fecha documento",dateFormat:"yy//mm/dd",showIcon:!0,value:i,onChange:s=>I(s.value),selectionMode:"range",readOnlyInput:!0})}),e.jsx("div",{className:"w-full card mb-1",children:e.jsx(z,{className:"max-h-10 border-0 flex p-0",placeholder:"Rango de fecha registro",dateFormat:"yy//mm/dd",showIcon:!0,value:c,onChange:s=>A(s.value),selectionMode:"range",readOnlyInput:!0})}),e.jsx("div",{className:"flex gap-3",children:e.jsx("div",{children:e.jsxs(ue,{children:[e.jsx(pe,{className:"sm:flex text-tiny lg:text-small",children:e.jsx(T,{endContent:e.jsx(u,{path:ne,size:1}),variant:"flat",children:"Accion"})}),e.jsx(he,{disallowEmptySelection:!0,"aria-label":"Table Columns",closeOnSelect:!1,selectedKeys:d,selectionMode:"multiple",onSelectionChange:K,children:S.map(s=>e.jsx(fe,{children:s.nombre},s.id))})]})})})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("span",{className:"text-default-400 text-tiny lg:text-small",children:["Total ",N.length," filas"]})}),e.jsxs("div",{className:"flex gap-5",children:[e.jsxs(T,{color:"warning",className:"min-w-0 min-h-0",onPress:()=>se(),children:[e.jsx(u,{path:ie,size:1}),e.jsx("p",{className:"hidden sm:flex",children:"Limpiar filtros"})]}),e.jsxs("label",{className:"flex items-center text-default-400 text-tiny lg:text-small",children:["Filas por pagina:",e.jsx(de,{onChange:s=>{U(s),o(1)},value:m,opciones:[{id:5,nombre:5},{id:8,nombre:8},{id:12,nombre:12}]})]})]})]})]})}),e.jsx(le,{children:e.jsx("div",{children:e.jsx("div",{children:e.jsxs(xe,{"aria-label":"Tabla historial",color:"primary",selectedKeys:B,onSelectionChange:L,bottomContent:e.jsx("div",{className:"flex w-full justify-center",children:e.jsx(be,{isCompact:!0,showControls:!0,showShadow:!0,color:"secondary",page:_,total:G,onChange:s=>o(s)})}),classNames:{wrapper:"min-h-[222px]"},children:[e.jsx(je,{children:q.map(s=>e.jsx(ge,{className:"text-start text-small",children:s.name},s.uid))}),e.jsx(Ce,{emptyContent:"No existen historial",children:Q.map((s,a)=>e.jsxs(we,{className:"text-start",children:[e.jsx(p,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.user_nombre}),e.jsxs(p,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:[s.responsable.nombres," ",s.responsable.apellidos]}),e.jsx(p,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.accion.nombre}),e.jsx(p,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.detalles}),e.jsx(p,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:new Date(s.created_at).toLocaleString()})]},a))})]})})})})]})};export{Ve as default};
