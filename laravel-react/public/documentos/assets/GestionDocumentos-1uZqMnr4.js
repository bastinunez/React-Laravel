import{r as l,q as Ye,W as Ze,j as e,a as es,d as J}from"./app-peuYjEpJ.js";import{A as ss,I as o,m as q,b as n,K as G,a as as,t as g,c as ts,L as ls,M as rs,N as de,d as ns,O as is,u as os}from"./AuthenticatedLayout-p56YD4qG.js";import{T as cs}from"./TitleTemplate-VNYP4QaZ.js";import{F as ds}from"./FilterTemplate-lUzzgUcq.js";import{C as ms}from"./ContentTemplate-Ei9JbHLa.js";import{C as hs}from"./calendar.esm-w5hXAkDL.js";import{S as xs}from"./Select-9YCHe840.js";import{T as us}from"./toast.esm-scV4M1sv.js";import{D as ps}from"./DownloadPDF-w-MjBMVS.js";import{d as N,a as w,b as v,m as y}from"./chunk-L6QJ42W6-TZgBgFLH.js";import{c as V}from"./chunk-OFH6WYRQ-8w9UZ3ya.js";import{u as me,m as he,a as xe,b as ue,c as pe,d as fe}from"./index-tpWZSiLQ.js";import{i as U}from"./chunk-TC4QW7OA-pQkPxgO7.js";import{t as je,p as ge,a as be,b as B,c as Ne,d as we,e as c}from"./chunk-YRZGWF2W-82o9ud7j.js";import"./import-a4H3-vU0.js";import"./import-afMrECeO.js";import"./import-Z4lNxWiv.js";import"./import-V_VTaOEA.js";import"./chunk-AMSULWPV-tDjQ4Vjp.js";const Ks=({auth:ve})=>{const W=l.useRef(null),x={success:"success",error:"error"},u={success:"Exito",error:"Error"},p=(s,t,a)=>{W.current.show({severity:t,summary:a,detail:s,life:3e3})},{hasRoles:fs,hasPermission:f}=os(),{all_documents:ye,direcciones:H,tipos:K,autores:L,estados:j}=Ye().props,[h,Ce]=l.useState(ye),Q=async()=>{try{const s=await axios.get("/api/all-documents");Ce(s.data.documentos)}catch(s){console.error("Error al obtener documentos:",s)}},{isOpen:Se,onOpen:Fe,onOpenChange:_e}=me(),{isOpen:ze,onOpen:X,onOpenChange:Ee}=me(),[Y,js]=l.useState("auto"),[Ae,De]=l.useState([]),[Me,Z]=l.useState(""),[Oe,ee]=l.useState(""),[Te,se]=l.useState(""),{data:b,setData:gs,post:bs,processing:Ns,errors:ws,reset:vs,patch:ae}=Ze({id_docs:[],opcion:""}),[d,Pe]=l.useState([]),[D,M]=l.useState(""),[O,T]=l.useState(""),[P,I]=l.useState(""),[C,te]=l.useState(""),Ie=!!D,Re=!!O,ke=!!P,[S,le]=l.useState("all"),[F,re]=l.useState("all"),[_,ne]=l.useState("all"),[z,ie]=l.useState("all"),[R,ys]=l.useState({column:"fecha",direction:"ascending"}),$=l.useMemo(()=>{let s=[...h];if(Ie&&(s=s.filter(t=>t.numero==parseInt(D))),Re&&(s=s.filter(t=>t.materia==O)),ke&&(s=s.filter(t=>t.rut==P)),C&&(s=s.filter(t=>{const a=new Date(t.fecha);return a>=C[0]&&a<=C[1]})),F!=="all"&&Array.from(F).length!==j.length){let t=new Set([...F].map(a=>{const r=j.find(i=>i.id===parseInt(a));return r?r.nombre:null}).filter(a=>a!==null));s=s.filter(a=>Array.from(t).includes(a.estado))}if(S!=="all"&&Array.from(S).length!==K.length){let t=new Set([...S].map(a=>{const r=K.find(i=>i.id===parseInt(a));return r?r.nombre:null}).filter(a=>a!==null));s=s.filter(a=>Array.from(t).includes(a.tipo))}if(_!=="all"&&Array.from(_).length!==H.length){let t=new Set([..._].map(a=>{const r=H.find(i=>i.id===parseInt(a));return r?r.nombre:null}).filter(a=>a!==null));s=s.filter(a=>Array.from(t).includes(a.direccion))}if(z!=="all"&&Array.from(z).length!==L.length){let t=new Set([...z].map(a=>{const r=L.find(i=>i.id===parseInt(a));return r?[r.nombres+" "+r.apellidos]:null}).filter(a=>a!==null));s=s.filter(a=>Array.from(t).some(r=>JSON.stringify(r)===JSON.stringify([a.autor])))}return s},[h,F,D,O,P,S,_,z,C]),[k,m]=l.useState(1),[E,Ge]=l.useState(8),oe=Math.ceil($.length/E),ce=l.useMemo(()=>{const s=(k-1)*E,t=s+E;return $.slice(s,t)},[k,$,E]),Ve=l.useMemo(()=>[...ce].sort((s,t)=>{const a=s[R.column],r=t[R.column],i=a<r?-1:a>r?1:0;return R.direction==="descending"?-i:i}),[R,ce]),Be=l.useCallback(s=>{s?(M(s),m(1)):M("")},[]),He=l.useCallback(()=>{M(""),m(1)},[]),Ke=l.useCallback(s=>{s?(T(s),m(1)):T("")},[]),Le=l.useCallback(()=>{T(""),console.log("se limpia materia"),m(1)},[]),$e=l.useCallback(s=>{s?(I(s),m(1)):I("")},[]),Je=l.useCallback(()=>{I(""),console.log("se limpia rut"),m(1)},[]),qe=()=>{I(""),te(""),T(""),M(""),le("all"),ie("all"),ne("all"),re("all")},Ue=[{name:"ID",uid:"id",sortable:!0},{name:"#",uid:"numero",sortable:!0},{name:"Autor",uid:"autor",sortable:!0},{name:"Fecha",uid:"fecha",sortable:!0},{name:"Tipo",uid:"tipo"},{name:"Materia",uid:"materia"},{name:"Rut",uid:"rut"},{name:"Dirección",uid:"direccion",sortable:!0},{name:"Anexos",uid:"anexos"},{name:"Estado",uid:"estado",sortable:!0},{name:"Archivo",uid:"name_file",sortable:!0},{name:"Acciones",uid:"actions"}],We=()=>{if(d.length!=0){const s=ps(d,h);s.length!==0&&(De(s),Fe())}else p("No seleccionaste datos",x.error,u.error)},Qe=s=>{if(d.length!=0){let t=[];d=="all"?(t=h.filter(a=>(a.estado,j[0].nombre,a.id)),t=t.map(a=>a.id),b.opcion=2):(t=Array.from(d).map(r=>{const i=h.find(A=>A.id==Number(r)&&A.estado===j[0].nombre);return i?i.id:void 0}).filter(r=>r!==void 0),b.opcion=2),b.id_docs=t,ae(route("gestion-documento.update-collection",0),{onSuccess:a=>{Q(),p("Exito",x.success,u.success)},onError:()=>{p("Falló",x.error,u.error)}})}else p("No seleccionaste datos",x.error,u.error)},Xe=s=>{if(d.length!=0){let t=[];d=="all"?(t=h.filter(a=>(a.estado,j[1].nombre,a.id)),t=t.map(a=>a.id),b.opcion=1):(t=Array.from(d).map(r=>{const i=h.find(A=>A.id==Number(r)&&A.estado===j[1].nombre);return i?i.id:void 0}).filter(r=>r!==void 0),b.opcion=1),b.id_docs=t,ae(route("gestion-documento.update-collection",0),{onSuccess:a=>{Q(),p("Exito",x.success,u.success)},onError:()=>{p("Error",x.error,u.error)}})}else p("No seleccionaste datos",x.error,u.error)};return e.jsxs(ss,{user:ve.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Gestión de Documentos"}),children:[e.jsxs("div",{children:[e.jsx(es,{title:"Gestión de Documentos"}),e.jsx(cs,{children:"Gestión de Documentos"}),e.jsx(us,{ref:W}),e.jsx(ds,{children:e.jsxs("div",{className:"lg:flex lg:flex-col gap-4",children:[e.jsxs("div",{className:"lg:flex mb-2",children:[e.jsxs("div",{className:"md:flex w-full gap-2 items-center justify-center mb-1 me-1",children:[e.jsxs("div",{className:"md:flex gap-2",children:[e.jsx(U,{isClearable:!0,classNames:{input:["border-none","placeholder:none"]},type:"text",className:"w-full mb-1",size:"sm",placeholder:"Buscar por numero...",startContent:e.jsx(o,{path:q,size:1}),value:D,onClear:()=>He(),onValueChange:Be}),e.jsx(U,{isClearable:!0,classNames:{input:["border-none"]},className:"w-full mb-1",size:"sm",placeholder:"Buscar por materia...",startContent:e.jsx(o,{path:q,size:1}),value:O,onClear:()=>Le(),onValueChange:Ke})]}),e.jsxs("div",{className:"md:flex gap-2",children:[e.jsx(U,{isClearable:!0,classNames:{input:["border-none"]},className:"w-full mb-1",size:"sm",placeholder:"Buscar por rut...",startContent:e.jsx(o,{path:q,size:1}),value:P,onClear:()=>Je(),onValueChange:$e}),e.jsx("div",{className:"w-full card",children:e.jsx(hs,{className:"max-h-12 border-0 flex p-0",placeholder:"Seleccione fecha",dateFormat:"yy//mm/dd",showIcon:!0,value:C,onChange:s=>te(s.value),selectionMode:"range",readOnlyInput:!0})})]})]}),e.jsxs("div",{className:"lg:flex gap-1",children:[e.jsxs("div",{className:"flex mb-1 gap-1",children:[e.jsx("div",{className:"w-full flex items-center",children:e.jsxs(N,{children:[e.jsx(w,{className:"text-tiny md:text-small",children:e.jsx(n,{endContent:e.jsx(o,{path:G,size:1}),variant:"flat",children:"Tipo"})}),e.jsx(v,{disallowEmptySelection:!0,"aria-label":"Table Columns",closeOnSelect:!1,selectedKeys:S,selectionMode:"multiple",onSelectionChange:le,children:K.map(s=>e.jsx(y,{children:s.nombre},s.id))})]})}),e.jsx("div",{className:"w-full flex items-center",children:e.jsxs(N,{children:[e.jsx(w,{className:"text-tiny md:text-small",children:e.jsx(n,{endContent:e.jsx(o,{path:G,size:1}),variant:"flat",children:"Autor"})}),e.jsx(v,{disallowEmptySelection:!0,"aria-label":"Table Columns",id:"autor",selectedKeys:z,onSelectionChange:ie,closeOnSelect:!1,selectionMode:"multiple",items:L,children:s=>e.jsx(y,{children:s.nombres},s.id)})]})})]}),e.jsxs("div",{className:"flex mb-1 gap-1",children:[e.jsx("div",{className:"w-full flex items-center",children:e.jsxs(N,{children:[e.jsx(w,{className:"text-tiny md:text-small",children:e.jsx(n,{endContent:e.jsx(o,{path:G,size:1}),variant:"flat",children:"Direccion"})}),e.jsx(v,{disallowEmptySelection:!0,"aria-label":"Table Columns",selectedKeys:_,onSelectionChange:ne,closeOnSelect:!1,selectionMode:"multiple",children:H.map(s=>e.jsx(y,{children:s.nombre},s.id))})]})}),e.jsx("div",{className:"w-full flex items-center",children:e.jsxs(N,{children:[e.jsx(w,{className:"text-tiny md:text-small",children:e.jsx(n,{endContent:e.jsx(o,{path:G,size:1}),variant:"flat",children:"Estado"})}),e.jsx(v,{disallowEmptySelection:!0,"aria-label":"Table Columns",closeOnSelect:!1,selectedKeys:F,selectionMode:"multiple",onSelectionChange:re,children:j.map(s=>e.jsx(y,{children:s.nombre},s.id))})]})})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("span",{className:"text-default-400 text-tiny lg:text-small",children:["Total ",h.length," documentos"]})}),e.jsxs("div",{className:"flex gap-5",children:[e.jsxs(n,{color:"warning",className:"min-w-0 min-h-0",onPress:()=>qe(),children:[e.jsx(o,{path:as,size:1}),e.jsx("p",{className:"hidden sm:flex",children:"Limpiar filtros"})]}),e.jsxs("label",{className:"flex items-center text-default-400 text-tiny lg:text-small",children:["Filas por pagina:",e.jsx(xs,{onChange:s=>{Ge(s),m(1)},value:E,opciones:[{id:5,nombre:5},{id:8,nombre:8},{id:12,nombre:12}]})]})]})]})]})}),e.jsxs(ms,{children:[e.jsxs("div",{className:"flex justify-between mb-3 gap-4",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-large md:text-2xl",children:"Resultados"})}),e.jsxs("div",{className:"flex gap-3",children:[f("Gestion-Crear documento")?e.jsx(e.Fragment,{children:e.jsx(J,{href:route("gestion-documento.create"),children:e.jsx(g,{content:"Crear documento",color:"success",children:e.jsx(n,{color:"success",variant:"solid",size:"sm",className:"min-w-0 min-h-0",endContent:e.jsx(o,{path:ts,size:1}),children:e.jsx("div",{className:"hidden text-tiny md:flex xl:text-small",children:"Agregar documento"})})})})}):e.jsx(e.Fragment,{}),f("Gestion-Anular documento")?e.jsx(e.Fragment,{children:e.jsx(g,{content:"Anular documentos",color:"danger",children:e.jsx(n,{color:"danger",variant:"solid",size:"sm",className:"min-w-0 min-h-0",onPress:()=>{Z(()=>()=>Qe()),ee("Anular documentos seleccionados"),se("¿Está seguro de anular los documentos?"),X()},endContent:e.jsx(o,{path:ls,size:1}),children:e.jsx("div",{className:"hidden text-tiny md:flex xl:text-small",children:"Anular seleccionados"})})})}):e.jsx(e.Fragment,{}),f("Gestion-Habilitar documento")?e.jsx(e.Fragment,{children:e.jsx(g,{content:"Habilitar documentos",color:"secondary",children:e.jsx(n,{color:"secondary",variant:"solid",size:"sm",className:"min-w-0 min-h-0",onPress:()=>{Z(()=>()=>Xe()),ee("Habilitar documentos seleccionados"),se("¿Está seguro de habilitar los documentos?"),X()},endContent:e.jsx(o,{path:rs,size:1}),children:e.jsx("div",{className:"hidden text-tiny md:flex xl:text-small",children:"Habilitar seleccionados"})})})}):e.jsx(e.Fragment,{}),f("Gestion-Descargar documento")?e.jsx(e.Fragment,{children:e.jsx(g,{content:"Descargar documentos",color:"primary",children:e.jsx(n,{color:"primary",variant:"solid",size:"sm",className:"min-w-0 min-h-0",onClick:We,endContent:e.jsx(o,{path:de,size:1}),children:e.jsx("div",{className:"hidden text-tiny md:flex xl:text-small",children:"Descargar seleccionados"})})})}):e.jsx(e.Fragment,{})]})]}),e.jsx("div",{className:"w-full",children:e.jsxs(je,{"aria-label":"Tabla documentos",color:"primary",selectionMode:"multiple",selectedKeys:d,onSelectionChange:Pe,bottomContent:e.jsx("div",{className:"flex w-full justify-center",children:e.jsx(ge,{isCompact:!0,showControls:!0,showShadow:!0,color:"secondary",page:k,total:oe,onChange:s=>m(s)})}),classNames:{wrapper:"min-h-[222px]"},children:[e.jsx(be,{children:Ue.map(s=>e.jsx(B,{className:"text-start text-small",children:s.name},s.uid))}),e.jsx(Ne,{emptyContent:"No existen documentos",children:Ve.map(s=>e.jsxs(we,{className:"text-start",children:[e.jsx(c,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.id}),e.jsx(c,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.numero}),e.jsx(c,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.autor}),e.jsx(c,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.fecha}),e.jsx(c,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.tipo}),e.jsx(c,{children:s.materia?e.jsx(e.Fragment,{children:e.jsxs(N,{type:"listbox",children:[e.jsx(w,{children:e.jsx(n,{variant:"bordered",size:"sm",children:"Ver materia"})}),e.jsx(v,{className:"h-64 overflow-auto","aria-label":"Static Actions",emptyContent:"No posee",children:e.jsx(y,{children:s.materia},s.materia)})]})}):e.jsx(e.Fragment,{children:e.jsx(V,{children:"No posee"})})}),e.jsx(c,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.rut}),e.jsx(c,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.direccion}),e.jsx(c,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.anexos.length!==0?e.jsx(e.Fragment,{children:e.jsxs(N,{type:"listbox",children:[e.jsx(w,{children:e.jsx(n,{variant:"bordered",size:"sm",children:"Ver Anexos"})}),e.jsx(v,{className:"h-64 overflow-auto","aria-label":"Static Actions",emptyContent:"No posee",children:s.anexos.map(t=>e.jsxs(y,{textValue:`Número: ${t.datos_anexo.numero}`,children:["Número: ",t.datos_anexo.numero]},t.documento_id_anexo))})]})}):e.jsx(e.Fragment,{children:e.jsx(V,{children:"No posee"})})}),e.jsx(c,{children:s.estado==="Habilitado"?e.jsx(e.Fragment,{children:e.jsx(V,{className:"capitalize",color:"success",size:"sm",variant:"flat",children:s.estado})}):e.jsx(e.Fragment,{children:e.jsx(V,{className:"capitalize",color:"danger",size:"sm",variant:"flat",children:s.estado})})}),e.jsx(c,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.name_file}),e.jsx(c,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:e.jsxs(e.Fragment,{children:[f("Gestion-Editar documento")?e.jsx(e.Fragment,{children:e.jsx(g,{content:"Editar",color:"warning",children:e.jsx(J,{href:route("gestion-documento.edit",String(s.id)),children:e.jsx(n,{className:"me-1",size:"sm",color:"warning",variant:"flat",children:e.jsx(o,{path:ns,size:1})})})})}):e.jsx(e.Fragment,{}),f("Visualizar documento")&&s.file&&s.estado=="Habilitado"?e.jsx(e.Fragment,{children:e.jsx(g,{content:"Visualizar",color:"secondary",children:e.jsx(J,{href:route("documento.visualizar",s.id),children:e.jsx(n,{className:"me-1",size:"sm",color:"secondary",variant:"flat",children:e.jsx(o,{path:is,size:1})})})})}):e.jsx(e.Fragment,{}),f("Descargar documento")&&s.file&&s.estado=="Habilitado"?e.jsx(e.Fragment,{children:e.jsx(g,{content:"Descargar",color:"primary",children:e.jsx("a",{download:s.name_file+".pdf",href:`data:${s.mime_file};base64,${s.file}`,children:e.jsx(n,{className:"me-1",size:"sm",color:"primary",variant:"flat",children:e.jsx(o,{path:de,size:1})})})})}):e.jsx(e.Fragment,{})]})})]},s.id))})]})})]}),e.jsx("div",{children:e.jsx(he,{isOpen:Se,placement:Y,onOpenChange:_e,size:"xl",children:e.jsx(xe,{children:s=>e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"flex flex-col gap-1",children:"Documentos sin archivo"}),e.jsxs(pe,{children:[e.jsx("div",{children:e.jsx("p",{children:"Los siguientes documentos no poseen archivos"})}),e.jsx("div",{children:e.jsxs(je,{"aria-label":"Tabla documentos anexos",color:"primary",bottomContent:e.jsx("div",{className:"flex w-full justify-center",children:e.jsx(ge,{isCompact:!0,showControls:!0,showShadow:!0,color:"secondary",page:k,total:oe,onChange:t=>m(t)})}),children:[e.jsxs(be,{children:[e.jsx(B,{children:"Numero de documento"}),e.jsx(B,{children:"Tipo de documento"}),e.jsx(B,{children:"Nombre archivo"})]}),e.jsx(Ne,{emptyContent:"No existen documentos",children:Ae.map(t=>e.jsxs(we,{className:"text-start",children:[e.jsx(c,{children:t.numero}),e.jsx(c,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:t.tipo}),e.jsx(c,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:t.file})]},t.numero))})]})})]}),e.jsx(fe,{children:e.jsx(n,{color:"danger",variant:"light",onPress:s,children:"Cerrar"})})]})})})}),e.jsx("div",{children:e.jsx(he,{isOpen:ze,placement:Y,onOpenChange:Ee,size:"md",children:e.jsx(xe,{children:s=>e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"flex flex-col gap-1",children:Oe}),e.jsx(pe,{children:Te}),e.jsxs(fe,{children:[e.jsx(n,{color:"danger",variant:"light",onPress:s,children:"Cerrar"}),e.jsx(n,{color:"primary",onPress:s,onClick:()=>Me(),children:"Confirmar"})]})]})})})})]}),e.jsx("div",{})]})};export{Ks as default};
