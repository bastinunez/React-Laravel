import{r as a,q as ie,j as e,a as ce}from"./app-eXGWw0Q1.js";import{C as de}from"./ContentTemplate-Tjr8Dmcy.js";import{T as me}from"./TitleTemplate-g8fmxVri.js";import{A as ue,I as c,m as I,b as y,K as T,a as he}from"./AuthenticatedLayout-xmXHQCqJ.js";import{T as pe}from"./toast.esm-hh8KxqiJ.js";import{C as V}from"./calendar.esm-zfuum9_B.js";import{S as xe}from"./Select-okRpXzt-.js";import{F as fe}from"./FilterTemplate-NM1ULPE2.js";import{i as z}from"./chunk-TC4QW7OA-vNTTWJaW.js";import{d as M,a as R,b as O,m as k}from"./chunk-L6QJ42W6-38BLIl0j.js";import{t as be,p as je,a as we,b as ge,c as Ce,d as Ne,e as n}from"./chunk-YRZGWF2W-C22kSm3v.js";import"./import-l4FZ2bLw.js";import"./import-oEubEFRA.js";import"./import-cu65eCSh.js";import"./import-Yb5YGcqg.js";import"./chunk-AMSULWPV-Pe1sDtjI.js";const Ee=({auth:H})=>{const J=a.useRef(null),{historial:S,tipos:_,autores:v,acciones:F}=ie().props,[q,G]=a.useState([]),[d,B]=a.useState(""),[m,L]=a.useState(""),[f,b]=a.useState(""),[j,w]=a.useState(""),[g,C]=a.useState(""),Q=!!f,U=!!j,W=!!g,[u,P]=a.useState("all"),[h,E]=a.useState("all"),[p,X]=a.useState("all"),[N,ye]=a.useState({column:"fecha",direction:"ascending"}),Y=[{name:"ID",uid:"id",sortable:!0},{name:"Número",uid:"numero",sortable:!0},{name:"Fecha",uid:"fecha",sortable:!0},{name:"Autor",uid:"autor",sortable:!0},{name:"Tipo",uid:"tipo",sortable:!0},{name:"Responsable",uid:"responsable",sortable:!0},{name:"Acción",uid:"accion",sortable:!0},{name:"Detalles",uid:"detalles",sortable:!0},{name:"Creado",uid:"creado",sortable:!0}],A=a.useMemo(()=>{let s=[...S];if(Q&&(s=s.filter(l=>l.doc_numero==parseInt(f))),U&&(s=s.filter(l=>(l.responsable.nombres+" "+l.responsable.apellidos).toLowerCase().includes(j.toLowerCase()))),W&&(s=s.filter(l=>l.detalles?l.detalles.toLowerCase().includes(g.toLowerCase()):null)),d&&(s=s.filter(l=>{const t=new Date(l.doc_fecha);return t>=d[0]&&t<=d[1]})),m&&(s=s.filter(l=>{const t=new Date(l.created_at);return t>=m[0]&&t<=m[1]})),p!=="all"&&Array.from(p).length!==F.length){let l=new Set([...p].map(t=>{const r=F.find(i=>i.id===parseInt(t));return r?r.nombre:null}).filter(t=>t!==null));s=s.filter(t=>Array.from(l).includes(t.accion.nombre))}if(u!=="all"&&Array.from(u).length!==_.length){let l=new Set([...u].map(t=>{const r=_.find(i=>i.id===parseInt(t));return r?r.nombre:null}).filter(t=>t!==null));s=s.filter(t=>Array.from(l).includes(t.doc_tipo))}if(h!=="all"&&Array.from(h).length!==v.length){let l=new Set([...h].map(t=>{const r=v.find(i=>i.id===parseInt(t));return r?[r.nombres+" "+r.apellidos]:null}).filter(t=>t!==null));s=s.filter(t=>Array.from(l).some(r=>JSON.stringify(r)===JSON.stringify([t.doc_autor])))}return s},[S,f,g,j,u,p,h,d,m]),[D,o]=a.useState(1),[x,Z]=a.useState(8),$=Math.ceil(A.length/x),K=a.useMemo(()=>{const s=(D-1)*x,l=s+x;return A.slice(s,l)},[D,A,x]),ee=a.useMemo(()=>[...K].sort((s,l)=>{const t=s[N.column],r=l[N.column],i=t<r?-1:t>r?1:0;return N.direction==="descending"?-i:i}),[N,K]),se=a.useCallback(s=>{s?(b(s),o(1)):b("")},[]),te=a.useCallback(()=>{b(""),o(1)},[]),le=a.useCallback(s=>{s?(w(s),o(1)):w("")},[]),ae=a.useCallback(()=>{w(""),o(1)},[]),re=a.useCallback(s=>{s?(C(s),o(1)):C("")},[]),ne=a.useCallback(()=>{C(""),o(1)},[]),oe=()=>{b(""),L(""),B(""),P("all"),E("all"),w(""),C("")};return e.jsxs(ue,{user:H.user,children:[e.jsx(ce,{title:"Historial de documentos"}),e.jsx(pe,{ref:J}),e.jsx(me,{children:"Historial de documentos"}),e.jsx(fe,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"md:flex justify-center gap-2 items-end",children:[e.jsxs("div",{className:"md:flex w-full gap-2",children:[e.jsx(z,{isClearable:!0,classNames:{input:["border-none"]},type:"text",className:"w-full mb-1",size:"sm",placeholder:"Buscar por numero...",startContent:e.jsx(c,{path:I,size:1}),value:f,onClear:()=>te(),onValueChange:se}),e.jsx(z,{isClearable:!0,classNames:{input:["border-none"]},type:"text",className:"w-full mb-1",size:"sm",placeholder:"Buscar por responsable...",startContent:e.jsx(c,{path:I,size:1}),value:j,onClear:()=>ae(),onValueChange:le}),e.jsx(z,{isClearable:!0,classNames:{input:["border-none"]},type:"text",className:"w-full mb-1",size:"sm",placeholder:"Buscar por detalles...",startContent:e.jsx(c,{path:I,size:1}),value:g,onClear:()=>ne(),onValueChange:re})]}),e.jsxs("div",{className:"w-full md:flex gap-2",children:[e.jsx("div",{className:" mb-1 card",children:e.jsx(V,{className:"max-h-10 border-0 flex p-0",placeholder:"Fecha documento",dateFormat:"yy//mm/dd",showIcon:!0,value:d,onChange:s=>B(s.value),selectionMode:"range",readOnlyInput:!0})}),e.jsx("div",{className:" mb-1 card",children:e.jsx(V,{className:"max-h-10 border-0 flex p-0",placeholder:"Fecha registro",dateFormat:"yy//mm/dd",showIcon:!0,value:m,onChange:s=>L(s.value),selectionMode:"range",readOnlyInput:!0})})]}),e.jsxs("div",{className:"flex gap-2 mb-1",children:[e.jsx("div",{children:e.jsxs(M,{children:[e.jsx(R,{className:"text-tiny lg:text-small",children:e.jsx(y,{endContent:e.jsx(c,{path:T,size:1}),variant:"flat",children:"Accion"})}),e.jsx(O,{disallowEmptySelection:!0,"aria-label":"Table Columns",closeOnSelect:!1,selectedKeys:p,selectionMode:"multiple",onSelectionChange:X,children:F.map(s=>e.jsx(k,{children:s.nombre},s.id))})]})}),e.jsx("div",{children:e.jsxs(M,{children:[e.jsx(R,{className:"text-tiny lg:text-small",children:e.jsx(y,{endContent:e.jsx(c,{path:T,size:1}),variant:"flat",children:"Tipo"})}),e.jsx(O,{disallowEmptySelection:!0,"aria-label":"Table Columns",closeOnSelect:!1,selectedKeys:u,selectionMode:"multiple",onSelectionChange:P,children:_.map(s=>e.jsx(k,{children:s.nombre},s.id))})]})}),e.jsx("div",{children:e.jsxs(M,{children:[e.jsx(R,{className:"text-tiny lg:text-small",children:e.jsx(y,{endContent:e.jsx(c,{path:T,size:1}),variant:"flat",children:"Autor"})}),e.jsx(O,{disallowEmptySelection:!0,"aria-label":"Table Columns",id:"autor",selectedKeys:h,onSelectionChange:E,closeOnSelect:!1,selectionMode:"multiple",items:v,children:s=>e.jsx(k,{children:s.nombres},s.id)})]})})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("span",{className:"text-default-400 text-tiny lg:text-small",children:["Total ",S.length," filas"]})}),e.jsxs("div",{className:"flex gap-5",children:[e.jsxs(y,{color:"warning",onPress:()=>oe(),children:[e.jsx(c,{path:he,size:1}),e.jsx("p",{className:"hidden lg:flex",children:"Limpiar filtros"})]}),e.jsxs("label",{className:"flex items-center text-default-400 text-tiny lg:text-small",children:["Filas por pagina:",e.jsx(xe,{onChange:s=>{Z(s),o(1)},value:x,opciones:[{id:5,nombre:5},{id:8,nombre:8},{id:12,nombre:12}]})]})]})]})]})}),e.jsx(de,{children:e.jsx("div",{children:e.jsx("div",{children:e.jsxs(be,{"aria-label":"Tabla historial",color:"primary",className:"",selectedKeys:q,onSelectionChange:G,bottomContent:e.jsx("div",{className:"flex w-full justify-center",children:e.jsx(je,{isCompact:!0,showControls:!0,showShadow:!0,color:"secondary",page:D,total:$,onChange:s=>o(s)})}),classNames:{wrapper:"min-h-[222px]"},children:[e.jsx(we,{className:"",children:Y.map(s=>e.jsx(ge,{className:"text-start text-small",children:s.name},s.uid))}),e.jsx(Ce,{emptyContent:"No existen historial",children:ee.map((s,l)=>e.jsxs(Ne,{className:"text-start",children:[e.jsx(n,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.doc_id}),e.jsx(n,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.doc_numero}),e.jsx(n,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.doc_fecha}),e.jsx(n,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.doc_autor}),e.jsx(n,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.doc_tipo}),e.jsxs(n,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:[s.responsable.nombres," ",s.responsable.apellidos]}),e.jsx(n,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.accion.nombre}),e.jsx(n,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.detalles}),e.jsx(n,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:new Date(s.created_at).toLocaleString()})]},l))})]})})})})]})};export{Ee as default};
