import{r as t,q as De,W as Ae,j as e,a as Me,d as Te}from"./app-peuYjEpJ.js";import{A as Ie,I as n,m as B,b as o,K as A,a as Oe,t as K,N as X,O as Ee,u as Pe}from"./AuthenticatedLayout-p56YD4qG.js";import{T as Re}from"./TitleTemplate-VNYP4QaZ.js";import{F as Ve}from"./FilterTemplate-lUzzgUcq.js";import{C as ke}from"./ContentTemplate-Ei9JbHLa.js";import{C as Be}from"./calendar.esm-w5hXAkDL.js";import{S as Ke}from"./Select-9YCHe840.js";import{T as He}from"./toast.esm-scV4M1sv.js";import{D as $e}from"./DownloadPDF-w-MjBMVS.js";import{u as Ge,m as Je,a as Le,b as qe,c as We,d as Qe}from"./index-tpWZSiLQ.js";import{i as H}from"./chunk-TC4QW7OA-pQkPxgO7.js";import{d as m,a as h,b as x,m as u}from"./chunk-L6QJ42W6-TZgBgFLH.js";import{t as Y,p as Z,a as ee,b as M,c as se,d as ae,e as i}from"./chunk-YRZGWF2W-82o9ud7j.js";import{c as T}from"./chunk-OFH6WYRQ-8w9UZ3ya.js";import"./import-a4H3-vU0.js";import"./import-Z4lNxWiv.js";import"./import-V_VTaOEA.js";import"./import-afMrECeO.js";import"./chunk-AMSULWPV-tDjQ4Vjp.js";const bs=({auth:le})=>{const $=t.useRef(null),te={success:"success",error:"error"},re={success:"Exito",error:"Error"},ie=(s,a,l)=>{$.current.show({severity:a,summary:l,detail:s,life:3e3})},{hasRoles:Ue,hasPermission:I}=Pe(),{all_documents:ne,direcciones:O,tipos:E,autores:P,estados:R}=De().props,[N,Xe]=t.useState(ne),{isOpen:oe,onOpen:ce,onOpenChange:de}=Ge(),[me,Ye]=t.useState("auto"),[he,xe]=t.useState([]);Ae({id_docs:[],opcion:""});const[V,ue]=t.useState([]),[v,y]=t.useState(""),[C,S]=t.useState(""),[_,F]=t.useState(""),[p,G]=t.useState(""),pe=!!v,fe=!!C,je=!!_,[f,J]=t.useState("all"),[j,L]=t.useState("all"),[g,q]=t.useState("all"),[b,W]=t.useState("all"),[z,Ze]=t.useState({column:"fecha",direction:"ascending"}),k=t.useMemo(()=>{let s=[...N];if(pe&&(s=s.filter(a=>a.numero==parseInt(v))),fe&&(s=s.filter(a=>a.materia==C)),je&&(s=s.filter(a=>a.rut==_)),p&&(s=s.filter(a=>{const l=new Date(a.fecha);return l>=p[0]&&l<=p[1]})),j!=="all"&&Array.from(j).length!==R.length){let a=new Set([...j].map(l=>{const r=R.find(c=>c.id===parseInt(l));return r?r.nombre:null}).filter(l=>l!==null));s=s.filter(l=>Array.from(a).includes(l.estado))}if(f!=="all"&&Array.from(f).length!==E.length){let a=new Set([...f].map(l=>{const r=E.find(c=>c.id===parseInt(l));return r?r.nombre:null}).filter(l=>l!==null));s=s.filter(l=>Array.from(a).includes(l.tipo))}if(g!=="all"&&Array.from(g).length!==O.length){let a=new Set([...g].map(l=>{const r=O.find(c=>c.id===parseInt(l));return r?r.nombre:null}).filter(l=>l!==null));s=s.filter(l=>Array.from(a).includes(l.direccion))}if(b!=="all"&&Array.from(b).length!==P.length){let a=new Set([...b].map(l=>{const r=P.find(c=>c.id===parseInt(l));return r?[r.nombres+" "+r.apellidos]:null}).filter(l=>l!==null));s=s.filter(l=>Array.from(a).some(r=>JSON.stringify(r)===JSON.stringify([l.autor])))}return s},[N,j,v,C,_,f,g,b,p]),[D,d]=t.useState(1),[w,ge]=t.useState(8),Q=Math.ceil(k.length/w),U=t.useMemo(()=>{const s=(D-1)*w,a=s+w;return k.slice(s,a)},[D,k,w]),be=t.useMemo(()=>[...U].sort((s,a)=>{const l=s[z.column],r=a[z.column],c=l<r?-1:l>r?1:0;return z.direction==="descending"?-c:c}),[z,U]),we=t.useCallback(s=>{s?(y(s),d(1)):y("")},[]),Ne=t.useCallback(()=>{y(""),d(1)},[]),ve=t.useCallback(s=>{s?(S(s),d(1)):S("")},[]),ye=t.useCallback(()=>{S(""),console.log("se limpia materia"),d(1)},[]),Ce=t.useCallback(s=>{s?(F(s),d(1)):F("")},[]),Se=t.useCallback(()=>{F(""),console.log("se limpia rut"),d(1)},[]),_e=()=>{F(""),G(""),S(""),y(""),J("all"),W("all"),q("all"),L("all")},Fe=[{name:"#",uid:"numero",sortable:!0},{name:"Autor",uid:"autor",sortable:!0},{name:"Fecha",uid:"fecha",sortable:!0},{name:"Tipo",uid:"tipo"},{name:"Materia",uid:"materia"},{name:"Rut",uid:"rut"},{name:"Dirección",uid:"direccion",sortable:!0},{name:"Anexos",uid:"anexos"},{name:"Estado",uid:"estado",sortable:!0},{name:"Archivo",uid:"name_file",sortable:!0},{name:"Acciones",uid:"actions"}],ze=()=>{if(V.length!=0){const s=$e(V,N);s.length!==0&&(xe(s),ce())}else ie("No seleccionaste datos",te.error,re.error)};return e.jsxs(Ie,{user:le.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Documentos"}),children:[e.jsxs("div",{children:[e.jsx(Me,{title:"Documentos"}),e.jsx(Re,{children:"Documentos"}),e.jsx(He,{ref:$}),e.jsx(Ve,{children:e.jsxs("div",{className:"lg:flex lg:flex-col gap-4",children:[e.jsxs("div",{className:"lg:flex mb-2",children:[e.jsxs("div",{className:"md:flex w-full gap-2 items-center justify-center mb-1 me-1",children:[e.jsxs("div",{className:"md:flex gap-2",children:[e.jsx(H,{isClearable:!0,classNames:{input:["border-none","placeholder:none"]},type:"text",className:"w-full mb-1",size:"sm",placeholder:"Buscar por numero...",startContent:e.jsx(n,{path:B,size:1}),value:v,onClear:()=>Ne(),onValueChange:we}),e.jsx(H,{isClearable:!0,classNames:{input:["border-none"]},className:"w-full mb-1",size:"sm",placeholder:"Buscar por materia...",startContent:e.jsx(n,{path:B,size:1}),value:C,onClear:()=>ye(),onValueChange:ve})]}),e.jsxs("div",{className:"md:flex gap-2",children:[e.jsx(H,{isClearable:!0,classNames:{input:["border-none"]},className:"w-full mb-1",size:"sm",placeholder:"Buscar por rut...",startContent:e.jsx(n,{path:B,size:1}),value:_,onClear:()=>Se(),onValueChange:Ce}),e.jsx("div",{className:"w-full card",children:e.jsx(Be,{className:"max-h-12 border-0 flex p-0",placeholder:"Seleccione fecha",dateFormat:"yy//mm/dd",showIcon:!0,value:p,onChange:s=>G(s.value),selectionMode:"range",readOnlyInput:!0})})]})]}),e.jsxs("div",{className:"lg:flex gap-1",children:[e.jsxs("div",{className:"flex mb-1 gap-1",children:[e.jsx("div",{className:"w-full flex items-center",children:e.jsxs(m,{children:[e.jsx(h,{className:"text-tiny md:text-small",children:e.jsx(o,{endContent:e.jsx(n,{path:A,size:1}),variant:"flat",children:"Tipo"})}),e.jsx(x,{disallowEmptySelection:!0,"aria-label":"Table Columns",closeOnSelect:!1,selectedKeys:f,selectionMode:"multiple",onSelectionChange:J,children:E.map(s=>e.jsx(u,{children:s.nombre},s.id))})]})}),e.jsx("div",{className:"w-full flex items-center",children:e.jsxs(m,{children:[e.jsx(h,{className:"text-tiny md:text-small",children:e.jsx(o,{endContent:e.jsx(n,{path:A,size:1}),variant:"flat",children:"Autor"})}),e.jsx(x,{disallowEmptySelection:!0,"aria-label":"Table Columns",id:"autor",selectedKeys:b,onSelectionChange:W,closeOnSelect:!1,selectionMode:"multiple",items:P,children:s=>e.jsx(u,{children:s.nombres},s.id)})]})})]}),e.jsxs("div",{className:"flex mb-1 gap-1",children:[e.jsx("div",{className:"w-full flex items-center",children:e.jsxs(m,{children:[e.jsx(h,{className:"text-tiny md:text-small",children:e.jsx(o,{endContent:e.jsx(n,{path:A,size:1}),variant:"flat",children:"Direccion"})}),e.jsx(x,{disallowEmptySelection:!0,"aria-label":"Table Columns",selectedKeys:g,onSelectionChange:q,closeOnSelect:!1,selectionMode:"multiple",children:O.map(s=>e.jsx(u,{children:s.nombre},s.id))})]})}),e.jsx("div",{className:"w-full flex items-center",children:e.jsxs(m,{children:[e.jsx(h,{className:"text-tiny md:text-small",children:e.jsx(o,{endContent:e.jsx(n,{path:A,size:1}),variant:"flat",children:"Estado"})}),e.jsx(x,{disallowEmptySelection:!0,"aria-label":"Table Columns",closeOnSelect:!1,selectedKeys:j,selectionMode:"multiple",onSelectionChange:L,children:R.map(s=>e.jsx(u,{children:s.nombre},s.id))})]})})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("span",{className:"text-default-400 text-tiny lg:text-small",children:["Total ",N.length," documentos"]})}),e.jsxs("div",{className:"flex gap-5",children:[e.jsxs(o,{color:"warning",className:"min-w-0 min-h-0",onPress:()=>_e(),children:[e.jsx(n,{path:Oe,size:1}),e.jsx("p",{className:"hidden sm:flex",children:"Limpiar filtros"})]}),e.jsxs("label",{className:"flex items-center text-default-400 text-tiny lg:text-small",children:["Filas por pagina:",e.jsx(Ke,{onChange:s=>{ge(s),d(1)},value:w,opciones:[{id:5,nombre:5},{id:8,nombre:8},{id:12,nombre:12}]})]})]})]})]})}),e.jsxs(ke,{children:[e.jsxs("div",{className:"flex justify-between mb-3",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-large md:text-2xl",children:"Resultados"})}),e.jsx("div",{className:"flex gap-3",children:I("Gestion-Descargar documento")?e.jsx(e.Fragment,{children:e.jsx(K,{content:"Descargar documentos",color:"primary",children:e.jsx(o,{color:"primary",variant:"solid",size:"sm",className:"min-w-0 min-h-0",onClick:ze,endContent:e.jsx(n,{path:X,size:1}),children:e.jsx("div",{className:"hidden text-tiny md:flex md:text-small",children:"Descargar seleccionados"})})})}):e.jsx(e.Fragment,{})})]}),e.jsx("div",{className:"w-full",children:e.jsxs(Y,{"aria-label":"Tabla documentos",color:"primary",selectionMode:"multiple",selectedKeys:V,onSelectionChange:ue,bottomContent:e.jsx("div",{className:"flex w-full justify-center",children:e.jsx(Z,{isCompact:!0,showControls:!0,showShadow:!0,color:"secondary",page:D,total:Q,onChange:s=>d(s)})}),classNames:{wrapper:"min-h-[222px]"},children:[e.jsx(ee,{children:Fe.map(s=>e.jsx(M,{className:"text-start text-small",children:s.name},s.uid))}),e.jsx(se,{emptyContent:"No existen documentos",children:be.map(s=>e.jsxs(ae,{className:"text-start",children:[e.jsx(i,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.numero}),e.jsx(i,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.autor}),e.jsx(i,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.fecha}),e.jsx(i,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.tipo}),e.jsx(i,{children:s.materia?e.jsx(e.Fragment,{children:e.jsxs(m,{type:"listbox",children:[e.jsx(h,{children:e.jsx(o,{variant:"bordered",size:"sm",children:"Ver materia"})}),e.jsx(x,{className:"h-64 overflow-auto","aria-label":"Static Actions",emptyContent:"No posee",children:e.jsx(u,{children:s.materia},s.materia)})]})}):e.jsx(e.Fragment,{children:e.jsx(T,{children:"No posee"})})}),e.jsx(i,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.rut}),e.jsx(i,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.direccion}),e.jsx(i,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.anexos.length!==0?e.jsx(e.Fragment,{children:e.jsxs(m,{type:"listbox",children:[e.jsx(h,{children:e.jsx(o,{variant:"bordered",size:"sm",children:"Ver Anexos"})}),e.jsx(x,{className:"h-64 overflow-auto","aria-label":"Static Actions",onScroll:!0,emptyContent:"No posee",children:s.anexos.map(a=>e.jsxs(u,{textValue:`Número: ${a.datos_anexo.numero}`,children:["Número: ",a.datos_anexo.numero]},a.documento_id_anexo))})]})}):e.jsx(e.Fragment,{children:e.jsx(T,{children:"No posee"})})}),e.jsx(i,{children:s.estado==="Habilitado"?e.jsx(e.Fragment,{children:e.jsx(T,{className:"capitalize",color:"success",size:"sm",variant:"flat",children:s.estado})}):e.jsx(e.Fragment,{children:e.jsx(T,{className:"capitalize",color:"danger",size:"sm",variant:"flat",children:s.estado})})}),e.jsx(i,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s.name_file}),e.jsx(i,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:e.jsxs(e.Fragment,{children:[I("Visualizar documento")&&s.file&&s.estado=="Habilitado"?e.jsx(e.Fragment,{children:e.jsx(K,{content:"Visualizar",color:"secondary",children:e.jsx(Te,{href:route("documento.show",s.id),children:e.jsx(o,{className:"me-1",size:"sm",color:"secondary",variant:"flat",children:e.jsx(n,{path:Ee,size:1})})})})}):e.jsx(e.Fragment,{}),I("Descargar documento")&&s.file&&s.estado=="Habilitado"?e.jsx(e.Fragment,{children:e.jsx(K,{content:"Descargar",color:"primary",children:e.jsx("a",{download:s.name_file+".pdf",href:`data:${s.mime_file};base64,${s.file}`,children:e.jsx(o,{className:"me-1",size:"sm",color:"primary",variant:"flat",children:e.jsx(n,{path:X,size:1})})})})}):e.jsx(e.Fragment,{})]})})]},s.id))})]})})]}),e.jsx("div",{children:e.jsx(Je,{isOpen:oe,placement:me,onOpenChange:de,size:"xl",children:e.jsx(Le,{children:s=>e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"flex flex-col gap-1",children:"Documentos sin archivo"}),e.jsxs(We,{children:[e.jsx("div",{children:e.jsx("p",{children:"Los siguientes documentos no poseen archivos"})}),e.jsx("div",{children:e.jsxs(Y,{"aria-label":"Tabla documentos anexos",color:"primary",bottomContent:e.jsx("div",{className:"flex w-full justify-center",children:e.jsx(Z,{isCompact:!0,showControls:!0,showShadow:!0,color:"secondary",page:D,total:Q,onChange:a=>d(a)})}),children:[e.jsxs(ee,{children:[e.jsx(M,{children:"Numero de documento"}),e.jsx(M,{children:"Tipo de documento"}),e.jsx(M,{children:"Nombre archivo"})]}),e.jsx(se,{emptyContent:"No existen documentos",children:he.map(a=>e.jsxs(ae,{className:"text-start",children:[e.jsx(i,{children:a.numero}),e.jsx(i,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:a.tipo}),e.jsx(i,{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:a.file})]},a.numero))})]})})]}),e.jsx(Qe,{children:e.jsx(o,{color:"danger",variant:"light",onPress:s,children:"Cerrar"})})]})})})})]}),e.jsx("div",{})]})};export{bs as default};
