import{l as Me,b as Te,r as t,q as Fe,W as I,j as e,a as qe,d as Y}from"./app-peuYjEpJ.js";import{C as Pe}from"./ContentTemplate-Ei9JbHLa.js";import{T as ke}from"./TitleTemplate-VNYP4QaZ.js";import{A as ze,b as r,e as Z,t as ee,I as O,f as se,g as Oe}from"./AuthenticatedLayout-p56YD4qG.js";import{I as n}from"./InputLabel-wkdhkWUR.js";import{I as c}from"./InputError-9KAUk6AJ.js";import{T as M}from"./TextInput-kaLmirDK.js";import{S as _}from"./Select-9YCHe840.js";import{C as ae}from"./calendar.esm-w5hXAkDL.js";import{T as Be}from"./toast.esm-scV4M1sv.js";import{D as Ve}from"./DownloadPDF-w-MjBMVS.js";import{u as Le,m as Re,a as $e,b as He,c as Ke,d as Qe}from"./index-tpWZSiLQ.js";import{c as We}from"./chunk-AMSULWPV-tDjQ4Vjp.js";import{s as Ge,l as Je}from"./chunk-ZFWMN6TD-hM1Z1Unl.js";import{t as Xe,p as Ue,a as Ye,b as f,c as Ze,d as es,e as j}from"./chunk-YRZGWF2W-82o9ud7j.js";import"./import-a4H3-vU0.js";import"./import-V_VTaOEA.js";import"./import-afMrECeO.js";import"./import-Z4lNxWiv.js";Me("en");Te("es",{firstDayOfWeek:1,dayNames:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],dayNamesShort:["dom","lun","mar","mié","jue","vie","sáb"],dayNamesMin:["D","L","M","X","J","V","S"],monthNames:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],monthNamesShort:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],today:"Hoy",clear:"Limpiar"});const Es=({auth:oe})=>{const B=t.useRef(null),{isOpen:te,onOpen:b,onOpenChange:re}=Le();t.useState("auto");const[ne,V]=t.useState(""),[ce,L]=t.useState(""),[le,R]=t.useState(""),{documento:o,all_docs:$,direcciones:H,tipos:T,autores:F,flash:K}=Fe().props,[p,Q]=t.useState(!0),[w,W]=t.useState(!1),[g,G]=t.useState(!0),[y,J]=t.useState(!1),ie=o.anexos.map(s=>s.datos_anexo),[S,q]=t.useState([]),[v,de]=t.useState(ie),A=async()=>{if(o.id!==0)try{const s=await axios.get(`/api/documentos-anexos/${o.id}`);de(s.data.datos)}catch(s){console.error("Error al obtener documentos:",s)}},[P,k]=t.useState(new Set([])),me=s=>{k(new Set(s.target.value.split(",")))},ue=F.find(s=>o.autor===s.nombres+" "+s.apellidos),xe=H.find(s=>o.direccion===s.nombre),he=T.find(s=>o.tipo===s.nombre),{data:l,setData:x,patch:ss,put:as,errors:h,reset:os,post:fe}=I({rut_documento:o.rut?o.rut:"",numero_documento:o.numero,materia_documento:o.materia?o.materia:"",autor_documento:ue.id,direccion_documento:o.direccion?xe.id:"",archivo:o.file?o.file:"",fecha_documento:new Date(`${o.fecha}T00:00:00`),tipo_documento:he.id,estado:o.estado!="Habilitado"}),{data:N,setData:D,post:je,processing:ts,errors:C,reset:pe}=I({numero_documento:"",autor_documento:"",fecha_documento:"",tipo_documento:"",id_doc:o.id}),{data:X,setData:rs,delete:U,post:ns}=I({documento_id:o.id,anexos:[]}),{data:ge,setData:cs,delete:ls,post:ve,reset:Ne}=I({documento_id:o.id,anexos:[]});t.useEffect(()=>{K.FormDocumento=="Success"&&changeStateForm()},[K.FormDocumento]);const[z,_e]=t.useState(1),[E,is]=t.useState(5),be=Math.ceil(v.length/E),we=t.useMemo(()=>{const s=(z-1)*E,a=s+E;return v.slice(s,a)},[z,v,E]),i={success:"success",error:"error"},d={success:"Exito",error:"Error"},m=(s,a,u)=>{B.current.show({severity:a,summary:u,detail:s,life:3e3})},ye=async s=>{s.preventDefault(),fe(route("gestion-documento.update-doc",String(o.id)),{onSuccess:a=>{m(a.update,i.success,d.success)},onError:a=>{m(a.update,i.error,d.error)}})},Se=s=>{s.preventDefault(),console.log(N),je(route("documento-anexo.store"),{onSuccess:a=>{A(o.id),pe("numero_documento","autor_documento","tipo_documento","fecha_documento"),m(a.create,i.success,d.success)},onError:a=>{m(a.create,i.error,d.error)}})},Ae=s=>{s.preventDefault();let a="";P=="all"?a=$.map(u=>u.id):a=Array.from(P).map(Ie=>Ie),ge.anexos=a,k(new Set([])),ve(route("documento-anexo.agregar-existente"),{onSuccess:u=>{m(u.add_anexo,i.success,d.success),A(o.id),Ne("anexos"),k(new Set([]))},onError:u=>{m(u.add_anexo,i.error,d.error)}})},De=()=>{let s="";S=="all"?s=v.map(a=>a.id):s=Array.from(S).map(u=>u),X.anexos=s,U(route("documento-anexo.destroy",o.id),{onSuccess:a=>{q([]),A(),m(a.destroy,i.success,d.success)},onError:a=>{m(a.destroy,i.error,d.error)}})},Ce=s=>{X.anexos=[s],U(route("documento-anexo.destroy",s),{onSuccess:a=>{q([]),A(),m(a.destroy,i.success,d.success)},onError:a=>{m(a.destroy,i.error,d.error)}})},Ee=()=>{const s=Ve(S,v);s.length!==0&&(setSinArchivos(s),b())};return e.jsxs(ze,{user:oe.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Editar Documentos"}),children:[e.jsx(qe,{title:"Editar Documento"}),e.jsxs("div",{children:[e.jsx(ke,{children:"Editar Documento"}),e.jsx(Be,{ref:B}),e.jsx(Pe,{children:e.jsxs("div",{className:"md:p-5",children:[e.jsxs("div",{className:"md:flex w-full gap-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(r,{color:"secondary",className:"w-full text-medium",variant:p?"solid":"ghost",onClick:()=>{p||(W(!w),Q(!p))},children:"Editar metadatos Documento"})}),e.jsx("div",{className:"w-full",children:e.jsx(r,{color:"secondary",className:"w-full text-medium",variant:w?"solid":"ghost",onClick:()=>{w||(W(!w),Q(!p))},children:"Editar documentos anexos"})})]}),e.jsx(Z,{className:"mt-5 w-full"}),e.jsx("div",{className:"mt-5 w-full",children:p?e.jsx(e.Fragment,{children:e.jsxs("form",{className:"md:p-8",onSubmit:ye,children:[e.jsxs("div",{className:"md:flex w-full justify-between mb-5 md:gap-3 ",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(n,{value:"Selecciona tipo de documento"}),e.jsx(_,{opciones:T,value:l.tipo_documento,onChange:s=>{x("tipo_documento",s)},required:!0}),e.jsx(c,{message:h.tipo_documento,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(n,{value:"Selecciona autor de documento"}),e.jsx(_,{opciones:F,value:l.autor_documento,onChange:s=>x("autor_documento",s),required:!0}),e.jsx(c,{message:h.autor_documento,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(n,{value:"Selecciona direccion de documento"}),e.jsx(_,{opciones:H,value:l.direccion_documento,onChange:s=>x("direccion_documento",s),required:!0}),e.jsx(c,{message:h.direccion_documento,className:"mt-2"})]})]}),e.jsxs("div",{className:"w-full justify-between md:flex mb-5 md:gap-3",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(n,{value:"Ingresa rut"}),e.jsx(M,{type:"text",className:"w-full",value:l.rut_documento,onChange:s=>x("rut_documento",s.target.value)}),e.jsx(c,{message:h.rut_documento,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(n,{value:"Ingresa numero de documento"}),e.jsx(M,{type:"number",className:"w-full",disabled:!0,value:l.numero_documento,onChange:s=>x("numero_documento",s.target.value),required:!0}),e.jsx(c,{message:h.numero_documento,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(n,{value:"Ingresa materia de documento"}),e.jsx(M,{type:"text",className:"w-full",value:l.materia_documento,onChange:s=>x("materia_documento",s.target.value)}),e.jsx(c,{message:h.materia_documento,className:"mt-2"})]})]}),e.jsxs("div",{className:"w-full md:flex justify-between mb-8  md:gap-3",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(n,{value:"Ingresa fecha"}),e.jsx("div",{className:"card flex justify-content-center",children:e.jsx(ae,{value:l.fecha_documento,locale:"es",required:!0,onChange:s=>x("fecha_documento",s.target.value),readOnlyInput:!0})}),e.jsx(c,{message:h.fecha_documento,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(n,{value:"Agregar archivo"}),e.jsx("input",{onChange:s=>x("archivo",s.target.files[0]),id:"inputArchivo",style:{display:"none"},type:"file",accept:".pdf"}),e.jsx("label",{htmlFor:"inputArchivo",style:{cursor:"pointer",padding:"",border:"1px solid #ccc"},children:l.archivo?`Archivo seleccionado ${o.name_file}`:"Seleccionar archivo PDF"}),e.jsx(c,{message:h.archivo,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(n,{value:"Marque si el documento se encuentra anulado"}),e.jsx(We,{value:l.estado,onChange:s=>x("estado",s.target.checked),isSelected:l.estado,color:"danger",children:"Anulado"})]})]}),e.jsxs("div",{className:"w-full flex mb-5 gap-5",children:[e.jsx(Y,{href:route("gestion-documento.index"),className:"w-full",children:e.jsx(r,{className:"w-full text-large",color:"warning",size:"md",variant:"ghost",children:"Volver atrás"})}),e.jsx(ee,{content:"Confirmar cambios y agregar",color:"success",children:e.jsx(r,{onPress:b,color:"success",variant:"ghost",className:"w-full text-large",size:"md",children:"Guardar cambios"})})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx("div",{className:"mt-5 w-full",children:e.jsxs("div",{className:"md:flex w-full gap-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(r,{color:"secondary",className:"w-full text-medium",variant:g?"solid":"ghost",onClick:()=>{g||(J(!y),G(!g))},children:"Agregar nuevo documento"})}),e.jsx("div",{className:"w-full",children:e.jsx(r,{color:"secondary",className:"w-full text-medium",variant:y?"solid":"ghost",onClick:()=>{y||(J(!y),G(!g))},children:"Agregar documento existente"})})]})})}),g?e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-5",children:e.jsxs("form",{onSubmit:Se,children:[e.jsxs("div",{className:"md:flex w-full justify-between mb-5 gap-3",children:[e.jsxs("div",{className:"w-80",children:[e.jsx(n,{value:"Selecciona tipo de documento"}),e.jsx(_,{opciones:T,value:N.tipo_documento,onChange:s=>D("tipo_documento",s),required:!0}),e.jsx(c,{message:C.tipo_documento,className:"mt-2"})]}),e.jsxs("div",{className:"w-80",children:[e.jsx(n,{value:"Selecciona autor de documento"}),e.jsx(_,{opciones:F,value:N.autor_documento,onChange:s=>D("autor_documento",s),required:!0}),e.jsx(c,{message:C.autor_documento,className:"mt-2"})]}),e.jsxs("div",{className:"w-80",children:[e.jsx(n,{value:"Ingresa numero de documento"}),e.jsx(M,{className:"w-full",type:"number",value:N.numero_documento,onChange:s=>D("numero_documento",s.target.value),required:!0}),e.jsx(c,{message:C.numero_documento,className:"mt-2"})]}),e.jsxs("div",{className:"w-80",children:[e.jsx(n,{value:"Ingresa fecha"}),e.jsx("div",{className:"card flex justify-content-center",children:e.jsx(ae,{value:N.fecha_documento,locale:"es",inputStyle:{padding:"0.5rem "},required:!0,onChange:s=>D("fecha_documento",s.target.value),readOnlyInput:!0})}),e.jsx(c,{message:C.fecha_documento,className:"mt-2"})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx(r,{id:"submit_miniform",type:"submit",color:"primary",variant:"ghost",className:"w-full text-large",size:"md",children:"Agregar documento anexo"})})]})})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-5 ",children:e.jsxs("form",{onSubmit:Ae,className:"w-full gap-5 md:flex",children:[e.jsx("div",{className:"w-full",children:e.jsx(Ge,{label:"Documentos para anexar: ",selectionMode:"multiple",placeholder:"Seleccionar documentos...",selectedKeys:P,className:"",onChange:me,children:$.map(s=>e.jsx(Je,{textValue:s.numero+"/"+s.anno,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-small",children:"Documento número: "+s.numero+" | Año: "+s.anno}),e.jsx("span",{className:"text-tiny",children:"Autor: "+s.autor+" | Tipo: "+s.tipo+" | Dirección: "+s.direccion+" | Fecha: "+s.fecha})]})},s.id))})}),e.jsxs("div",{className:"flex items-center ",children:[e.jsx(r,{type:"submit",className:"w-full me-2",color:"primary",variant:"ghost",children:"Anexar documentos"}),e.jsx(Y,{href:route("gestion-documento.index"),className:"w-full",children:e.jsx(r,{className:"w-full text-large",color:"warning",variant:"ghost",children:"Volver atrás"})})]})]})})}),e.jsx(Z,{className:"mt-5"}),e.jsx("div",{className:"mt-5",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-3",children:[e.jsx("div",{className:"",children:e.jsx("h1",{className:"text-xl"})}),e.jsxs("div",{className:"gap-4 flex",children:[e.jsxs(r,{color:"danger",variant:"solid",onPress:()=>{R(()=>()=>De()),V("Eliminar documentos anexos"),L("¿Está seguro de eliminar los documentos?"),b()},startContent:e.jsx(O,{path:se,size:1}),children:[e.jsx("p",{className:"md:flex hidden",children:"Quitar seleccionados"})," "]}),e.jsx(r,{color:"primary",variant:"solid",onPress:Ee,startContent:e.jsx(O,{path:Oe,size:1}),children:e.jsx("p",{className:"md:flex hidden",children:"Descargar seleccionados"})})]})]}),e.jsx("div",{className:"",children:e.jsxs(Xe,{"aria-label":"Tabla documentos anexos",selectionMode:"multiple",selectedKeys:S,onSelectionChange:q,bottomContent:e.jsx("div",{className:"flex w-full justify-center",children:e.jsx(Ue,{isCompact:!0,showControls:!0,showShadow:!0,color:"secondary",page:z,total:be,onChange:s=>_e(s)})}),classNames:{wrapper:"min-h-[222px]"},children:[e.jsxs(Ye,{children:[e.jsx(f,{className:"text-medium",children:"ID"}),e.jsx(f,{className:"text-medium",children:"Numero de documento"}),e.jsx(f,{className:"text-medium",children:"Tipo de documento"}),e.jsx(f,{className:"text-medium",children:"Autor de documento"}),e.jsx(f,{className:"text-medium",children:"Fecha de documento"}),e.jsx(f,{className:"text-medium",children:"Acciones"})]}),e.jsx(Ze,{emptyContent:"Aún no hay documentos anexos",children:we.map(s=>e.jsxs(es,{children:[e.jsx(j,{children:s.id}),e.jsx(j,{children:s.numero}),e.jsx(j,{children:s.tipo}),e.jsxs(j,{children:[" ",s.autor?s.autor:s.autor_nombre+" "+s.autor_apellido," "]}),e.jsx(j,{children:s.fecha}),e.jsx(j,{children:e.jsx(ee,{content:"Quitar",color:"danger",children:e.jsx(r,{onPress:()=>{R(()=>()=>Ce(s.id)),V("Eliminar documentos anexos"),L("¿Está seguro de eliminar los documentos?"),b()},className:"",size:"sm",color:"danger",variant:"flat",children:e.jsx(O,{path:se,size:1})})})})]},s.id))})]})})]})})]})})]})}),e.jsx(Re,{isOpen:te,onOpenChange:re,children:e.jsx($e,{children:s=>e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"flex flex-col gap-1",children:ne}),e.jsx(Ke,{children:e.jsx("p",{children:ce})}),e.jsxs(Qe,{children:[e.jsx(r,{color:"danger",variant:"light",onPress:s,children:"Cancelar"}),e.jsx(r,{color:"primary",onPress:s,onClick:()=>le(),children:"Confirmar"})]})]})})})]})]})};export{Es as default};
