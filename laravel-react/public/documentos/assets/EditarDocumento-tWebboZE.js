import{l as Te,b as Fe,r as t,q as qe,W as F,j as e,a as Pe,d as Z}from"./app-eXGWw0Q1.js";import{C as ke}from"./ContentTemplate-Tjr8Dmcy.js";import{T as ze}from"./TitleTemplate-g8fmxVri.js";import{A as Oe,b as r,e as ee,t as se,I as L,f as ae,g as Be}from"./AuthenticatedLayout-xmXHQCqJ.js";import{I as n}from"./InputLabel-_BYtn3Q_.js";import{I as c}from"./InputError-Gq9t3JFB.js";import{T as q}from"./TextInput-ahoRra4W.js";import{S as _}from"./Select-okRpXzt-.js";import{C as oe}from"./calendar.esm-zfuum9_B.js";import{T as Ve}from"./toast.esm-hh8KxqiJ.js";import{D as Le}from"./DownloadPDF-ObElkOId.js";import{u as Qe,m as Re,a as $e,b as Ge,c as He,d as Ke}from"./index-eVSyYh-b.js";import{c as We}from"./chunk-AMSULWPV-Pe1sDtjI.js";import{s as Je,l as Xe}from"./chunk-ZFWMN6TD-RrwGKyM9.js";import{t as Ue,p as Ye,a as Ze,b as j,c as es,d as ss,e as f}from"./chunk-YRZGWF2W-C22kSm3v.js";import"./import-cu65eCSh.js";import"./import-oEubEFRA.js";import"./import-Yb5YGcqg.js";import"./import-l4FZ2bLw.js";Te("en");Fe("es",{firstDayOfWeek:1,dayNames:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],dayNamesShort:["dom","lun","mar","mié","jue","vie","sáb"],dayNamesMin:["D","L","M","X","J","V","S"],monthNames:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],monthNamesShort:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],today:"Hoy",clear:"Limpiar"});const Ms=({auth:te})=>{const Q=t.useRef(null),{isOpen:re,onOpen:p,onOpenChange:ne}=Qe();t.useState("auto");const[ce,b]=t.useState(""),[le,w]=t.useState(""),[ie,y]=t.useState(""),{documento:o,all_docs:R,direcciones:$,tipos:P,autores:k,flash:G}=qe().props,[g,H]=t.useState(!0),[S,K]=t.useState(!1),[v,W]=t.useState(!0),[A,J]=t.useState(!1),de=o.anexos.map(s=>s.datos_anexo),[D,z]=t.useState([]),[N,me]=t.useState(de),[as,ue]=t.useState([]),C=async()=>{if(o.id!==0)try{const s=await axios.get(`/api/documentos-anexos/${o.id}`);me(s.data.datos)}catch(s){console.error("Error al obtener documentos:",s)}},[O,B]=t.useState(new Set([])),xe=s=>{B(new Set(s.target.value.split(",")))},he=k.find(s=>o.autor===s.nombres+" "+s.apellidos),je=$.find(s=>o.direccion===s.nombre),fe=P.find(s=>o.tipo===s.nombre),{data:l,setData:i,patch:os,put:ts,errors:h,reset:rs,post:pe}=F({rut_documento:o.rut?o.rut:"",numero_documento:o.numero,materia_documento:o.materia?o.materia:"",autor_documento:he.id,direccion_documento:o.direccion?je.id:"",archivo:o.file?o.file:"",fecha_documento:new Date(`${o.fecha}T00:00:00`),tipo_documento:fe.id,estado:o.estado!="Habilitado"}),{data:E,setData:I,post:ge,processing:ns,errors:M,reset:ve}=F({numero_documento:"",autor_documento:"",fecha_documento:"",tipo_documento:"",id_doc:o.id}),{data:X,setData:cs,delete:U,post:ls}=F({documento_id:o.id,anexos:[]}),{data:Ne,setData:is,delete:ds,post:_e,reset:be}=F({documento_id:o.id,anexos:[]});t.useEffect(()=>{G.FormDocumento=="Success"&&changeStateForm()},[G.FormDocumento]);const[V,we]=t.useState(1),[T,ms]=t.useState(5),ye=Math.ceil(N.length/T),Se=t.useMemo(()=>{const s=(V-1)*T,a=s+T;return N.slice(s,a)},[V,N,T]),d={success:"success",error:"error"},m={success:"Exito",error:"Error"},u=(s,a,x)=>{Q.current.show({severity:a,summary:x,detail:s,life:3e3})},Y=async s=>{pe(route("gestion-documento.update-doc",String(o.id)),{onSuccess:a=>{u(a.update,d.success,m.success)},onError:a=>{u(a.update,d.error,m.error)}})},Ae=s=>{s.preventDefault(),ge(route("documento-anexo.store"),{onSuccess:a=>{C(o.id),ve("numero_documento","autor_documento","tipo_documento","fecha_documento"),u(a.create,d.success,m.success)},onError:a=>{u(a.create,d.error,m.error)}})},De=s=>{s.preventDefault();let a="";O=="all"?a=R.map(x=>x.id):a=Array.from(O).map(Me=>Me),Ne.anexos=a,B(new Set([])),_e(route("documento-anexo.agregar-existente"),{onSuccess:x=>{u(x.add_anexo,d.success,m.success),C(o.id),be("anexos"),B(new Set([]))},onError:x=>{u(x.add_anexo,d.error,m.error)}})},Ce=()=>{let s="";D=="all"?s=N.map(a=>a.id):s=Array.from(D).map(x=>x),X.anexos=s,U(route("documento-anexo.destroy",o.id),{onSuccess:a=>{z([]),C(),u(a.destroy,d.success,m.success)},onError:a=>{u(a.destroy,d.error,m.error)}})},Ee=s=>{X.anexos=[s],U(route("documento-anexo.destroy",s),{onSuccess:a=>{z([]),C(),u(a.destroy,d.success,m.success)},onError:a=>{u(a.destroy,d.error,m.error)}})},Ie=()=>{const s=Le(D,N);s.length!==0&&(ue(s),p())};return e.jsxs(Oe,{user:te.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Editar Documentos"}),children:[e.jsx(Pe,{title:"Editar Documento"}),e.jsxs("div",{children:[e.jsx(ze,{children:"Editar Documento"}),e.jsx(Ve,{ref:Q}),e.jsx(ke,{children:e.jsxs("div",{className:"md:p-5",children:[e.jsxs("div",{className:"md:flex w-full gap-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(r,{color:"secondary",className:"w-full text-medium",variant:g?"solid":"ghost",onClick:()=>{g||(K(!S),H(!g))},children:"Editar metadatos Documento"})}),e.jsx("div",{className:"w-full",children:e.jsx(r,{color:"secondary",className:"w-full text-medium",variant:S?"solid":"ghost",onClick:()=>{S||(K(!S),H(!g))},children:"Editar documentos anexos"})})]}),e.jsx(ee,{className:"mt-5 w-full"}),e.jsx("div",{className:"mt-5 w-full",children:g?e.jsx(e.Fragment,{children:e.jsxs("form",{className:"md:p-8",onSubmit:Y,children:[e.jsxs("div",{className:"md:flex w-full justify-between mb-5 md:gap-3 ",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(n,{value:"Selecciona tipo de documento"}),e.jsx(_,{opciones:P,value:l.tipo_documento,onChange:s=>{i("tipo_documento",s)},required:!0}),e.jsx(c,{message:h.tipo_documento,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(n,{value:"Selecciona autor de documento"}),e.jsx(_,{opciones:k,value:l.autor_documento,onChange:s=>i("autor_documento",s),required:!0}),e.jsx(c,{message:h.autor_documento,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(n,{value:"Selecciona direccion de documento"}),e.jsx(_,{opciones:$,value:l.direccion_documento,onChange:s=>i("direccion_documento",s),required:!0}),e.jsx(c,{message:h.direccion_documento,className:"mt-2"})]})]}),e.jsxs("div",{className:"w-full justify-between md:flex mb-5 md:gap-3",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(n,{value:"Ingresa rut"}),e.jsx(q,{type:"text",className:"w-full",value:l.rut_documento,onChange:s=>i("rut_documento",s.target.value)}),e.jsx(c,{message:h.rut_documento,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(n,{value:"Ingresa numero de documento"}),e.jsx(q,{type:"number",className:"w-full",disabled:!0,value:l.numero_documento,onChange:s=>i("numero_documento",s.target.value),required:!0}),e.jsx(c,{message:h.numero_documento,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(n,{value:"Ingresa materia de documento"}),e.jsx(q,{type:"text",className:"w-full",value:l.materia_documento,onChange:s=>i("materia_documento",s.target.value)}),e.jsx(c,{message:h.materia_documento,className:"mt-2"})]})]}),e.jsxs("div",{className:"w-full md:flex justify-between mb-8  md:gap-3",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(n,{value:"Ingresa fecha"}),e.jsx("div",{className:"card flex justify-content-center",children:e.jsx(oe,{value:l.fecha_documento,locale:"es",required:!0,onChange:s=>i("fecha_documento",s.target.value),readOnlyInput:!0})}),e.jsx(c,{message:h.fecha_documento,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(n,{value:"Agregar archivo"}),e.jsx("input",{onChange:s=>i("archivo",s.target.files[0]),type:"file",accept:".pdf",id:"inputArchivo",style:{display:"none"}}),e.jsx("label",{htmlFor:"inputArchivo",style:{cursor:"pointer",padding:"",border:"1px solid #ccc"},children:l.archivo?`Archivo seleccionado ${o.name_file}`:"Seleccionar archivo PDF"}),e.jsx(c,{message:h.archivo,className:"mt-2"}),e.jsx(r,{onPress:()=>i("archivo",""),color:"danger",className:"md:ms-1",children:"Quitar archivo"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(n,{value:"Marque si el documento se encuentra anulado"}),e.jsx(We,{value:l.estado,onChange:s=>i("estado",s.target.checked),isSelected:l.estado,color:"danger",children:"Anulado"})]})]}),e.jsxs("div",{className:"w-full flex mb-5 gap-5",children:[e.jsx(Z,{href:route("gestion-documento.index"),className:"w-full",children:e.jsx(r,{className:"w-full text-large",color:"warning",size:"md",variant:"ghost",children:"Volver atrás"})}),e.jsx(se,{content:"Confirmar cambios y agregar",color:"success",children:e.jsx(r,{onPress:()=>{y(()=>()=>Y()),b("Guardar cambios"),w("¿Está seguro de aplicar los cambios?"),p()},color:"success",variant:"ghost",className:"w-full text-large",size:"md",children:"Guardar cambios"})})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx("div",{className:"mt-5 w-full",children:e.jsxs("div",{className:"md:flex w-full gap-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(r,{color:"secondary",className:"w-full text-medium",variant:v?"solid":"ghost",onClick:()=>{v||(J(!A),W(!v))},children:"Agregar nuevo documento"})}),e.jsx("div",{className:"w-full",children:e.jsx(r,{color:"secondary",className:"w-full text-medium",variant:A?"solid":"ghost",onClick:()=>{A||(J(!A),W(!v))},children:"Agregar documento existente"})})]})})}),v?e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-5",children:e.jsxs("form",{onSubmit:Ae,children:[e.jsxs("div",{className:"md:flex w-full justify-between mb-5 gap-3",children:[e.jsxs("div",{className:"w-80",children:[e.jsx(n,{value:"Selecciona tipo de documento"}),e.jsx(_,{opciones:P,value:E.tipo_documento,onChange:s=>I("tipo_documento",s),required:!0}),e.jsx(c,{message:M.tipo_documento,className:"mt-2"})]}),e.jsxs("div",{className:"w-80",children:[e.jsx(n,{value:"Selecciona autor de documento"}),e.jsx(_,{opciones:k,value:E.autor_documento,onChange:s=>I("autor_documento",s),required:!0}),e.jsx(c,{message:M.autor_documento,className:"mt-2"})]}),e.jsxs("div",{className:"w-80",children:[e.jsx(n,{value:"Ingresa numero de documento"}),e.jsx(q,{className:"w-full",type:"number",value:E.numero_documento,onChange:s=>I("numero_documento",s.target.value),required:!0}),e.jsx(c,{message:M.numero_documento,className:"mt-2"})]}),e.jsxs("div",{className:"w-80",children:[e.jsx(n,{value:"Ingresa fecha"}),e.jsx("div",{className:"card flex justify-content-center",children:e.jsx(oe,{value:E.fecha_documento,locale:"es",inputStyle:{padding:"0.5rem "},required:!0,onChange:s=>I("fecha_documento",s.target.value),readOnlyInput:!0})}),e.jsx(c,{message:M.fecha_documento,className:"mt-2"})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx(r,{id:"submit_miniform",type:"submit",color:"primary",variant:"ghost",className:"w-full text-large",size:"md",children:"Agregar documento anexo"})})]})})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-5 ",children:e.jsxs("form",{onSubmit:De,className:"w-full gap-5 md:flex",children:[e.jsx("div",{className:"w-full",children:e.jsx(Je,{label:"Documentos para anexar: ",selectionMode:"multiple",placeholder:"Seleccionar documentos...",selectedKeys:O,className:"",onChange:xe,children:R.map(s=>e.jsx(Xe,{textValue:s.numero+"/"+s.anno,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-small",children:"Documento número: "+s.numero+" | Año: "+s.anno}),e.jsx("span",{className:"text-tiny",children:"Autor: "+s.autor+" | Tipo: "+s.tipo+" | Dirección: "+s.direccion+" | Fecha: "+s.fecha})]})},s.id))})}),e.jsxs("div",{className:"flex items-center ",children:[e.jsx(r,{type:"submit",className:"w-full me-2",color:"primary",variant:"ghost",children:"Anexar documentos"}),e.jsx(Z,{href:route("gestion-documento.index"),className:"w-full",children:e.jsx(r,{className:"w-full text-large",color:"warning",variant:"ghost",children:"Volver atrás"})})]})]})})}),e.jsx(ee,{className:"mt-5"}),e.jsx("div",{className:"mt-5",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-3",children:[e.jsx("div",{className:"",children:e.jsx("h1",{className:"text-xl"})}),e.jsxs("div",{className:"gap-4 flex",children:[e.jsxs(r,{color:"danger",variant:"solid",onPress:()=>{y(()=>()=>Ce()),b("Eliminar documentos anexos"),w("¿Está seguro de eliminar los documentos?"),p()},startContent:e.jsx(L,{path:ae,size:1}),children:[e.jsx("p",{className:"md:flex hidden",children:"Quitar seleccionados"})," "]}),e.jsx(r,{color:"primary",variant:"solid",onPress:()=>{y(()=>()=>Ie()),b("Descargar documentos anexos"),w("¿Está seguro de descargar los documentos?"),p()},startContent:e.jsx(L,{path:Be,size:1}),children:e.jsx("p",{className:"md:flex hidden",children:"Descargar seleccionados"})})]})]}),e.jsx("div",{className:"",children:e.jsxs(Ue,{"aria-label":"Tabla documentos anexos",selectionMode:"multiple",selectedKeys:D,onSelectionChange:z,bottomContent:e.jsx("div",{className:"flex w-full justify-center",children:e.jsx(Ye,{isCompact:!0,showControls:!0,showShadow:!0,color:"secondary",page:V,total:ye,onChange:s=>we(s)})}),classNames:{wrapper:"min-h-[222px]"},children:[e.jsxs(Ze,{children:[e.jsx(j,{className:"text-medium",children:"ID"}),e.jsx(j,{className:"text-medium",children:"Numero de documento"}),e.jsx(j,{className:"text-medium",children:"Tipo de documento"}),e.jsx(j,{className:"text-medium",children:"Autor de documento"}),e.jsx(j,{className:"text-medium",children:"Fecha de documento"}),e.jsx(j,{className:"text-medium",children:"Acciones"})]}),e.jsx(es,{emptyContent:"Aún no hay documentos anexos",children:Se.map(s=>e.jsxs(ss,{children:[e.jsx(f,{children:s.id}),e.jsx(f,{children:s.numero}),e.jsx(f,{children:s.tipo}),e.jsxs(f,{children:[" ",s.autor?s.autor:s.autor_nombre+" "+s.autor_apellido," "]}),e.jsx(f,{children:s.fecha}),e.jsx(f,{children:e.jsx(se,{content:"Quitar",color:"danger",children:e.jsx(r,{onPress:()=>{y(()=>()=>Ee(s.id)),b("Eliminar documentos anexos"),w("¿Está seguro de eliminar los documentos?"),p()},className:"",size:"sm",color:"danger",variant:"flat",children:e.jsx(L,{path:ae,size:1})})})})]},s.id))})]})})]})})]})})]})}),e.jsx(Re,{isOpen:re,onOpenChange:ne,children:e.jsx($e,{children:s=>e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"flex flex-col gap-1",children:ce}),e.jsx(He,{children:e.jsx("p",{children:le})}),e.jsxs(Ke,{children:[e.jsx(r,{color:"danger",variant:"light",onPress:s,children:"Cancelar"}),e.jsx(r,{color:"primary",onPress:s,onClick:()=>ie(),children:"Confirmar"})]})]})})})]})]})};export{Ms as default};
